<!DOCTYPE html>
<html class="" lang="en" dir="ltr">
  <head>
    <title>Setting up Metabase and PostgreSQL with Docker | Data Automation</title>



<meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Setting up Metabase and PostgreSQL with Docker | Data Automation" />

<meta property="og:url" content="https://www.automacaodedados.com.br/en/stories/configurando-metabase-e-postgresql-no-docker/">
<meta property="og:locale" content="en" />
<meta property="og:title" content="Setting up Metabase and PostgreSQL with Docker | Data Automation">
<meta property="og:description" content="Setting up Metabase and PostgreSQL with Docker | Data Automation">
<meta property="og:site_name" content="Data Automation">

<meta name="twitter:card" content="summary_large_image">


<meta property="og:type" content="article">
<meta property="article:author" content="Henrique Freitas Souza" />
<meta property="article:published_time" content="2020-11-17 09:10:00 &#43;0000 UTC" />
<meta property="article:modified_time" content="2021-11-20 09:10:00 &#43;0000 UTC" />
<meta name="twitter:label1" content="Estimated time to read" />
<meta name="twitter:data1" content="13 minutes" />

<meta property="article:tag" content="Automation" />
<meta property="article:section" content="Automation" />



<meta property="og:image" content="https://www.automacaodedados.com.br/en/stories/configurando-metabase-e-postgresql-no-docker/images/thumbnail.jpg">
<meta name="twitter:image" content="https://www.automacaodedados.com.br/en/stories/configurando-metabase-e-postgresql-no-docker/images/thumbnail.jpg">
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="400" />

<meta name="og:image:alt" content="Metabase, PostgreSQL and Docker logos">

    <link href="https://www.automacaodedados.com.br/images/favicon.ico" rel="icon" type="image/x-icon" />

	
	<link rel="alternate" hreflang="pt" href="https://www.automacaodedados.com.br/stories/configurando-metabase-e-postgresql-no-docker/" title="PortuguÃªs">
	

<link rel="preload" as="script" href="/js/ui.min.js" />
<link rel="preload" as="script" href="/js/theme.min.js" />
<link rel="preload" as="style" href="/css/fonts.min.css" />
<link rel="preload" as="style" href="/css/main.min.css" />
<link rel="stylesheet" href="/css/fonts.min.css" />
<link rel="stylesheet" href="/css/main.min.css" />
<script src="/js/ui.min.js" async></script>

    
  </head>
  <body class="overflow-x-hidden dark:bg-secondary">
    <div class="flex flex-col h-screen">
      <a class="sr-only focus:sr-only" href="#content">Skip to content</a>
      <header class="flex flex-col justify:between">
  <div class="container container-box mx-auto lg:px-0">
    <div class="px-2 flex flex-wrap justify-between items-center">
      <div class="w-6/12 md:w-auto">
        <a href="/en" class="flex items-center mr-2 font-title no-underline hover:no-underline focus:outline-none focus:ring-2 focus:ring-offset-8 focus:ring-secondary-darker dark:ring-offset-secondary dark:ring-white">
          <img class="mr-2 w-16 h-8" id="site-logo" src="https://www.automacaodedados.com.br/images/automacaodedados_logo.svg" alt="Logo Data Automation">
          <span class="text-base font-title leading-none mb-0 break-words dark:text-white">Data Automation</span>
        </a>
      </div>
      <div class="flex items-center lg:order-last">
        <a class="p-2 mr-2 inline-block no-underline focus:outline-none focus:ring-2 focus:ring-secondary-darker dark:focus:ring-white lg:mr-0 lg:ml-2" id="theme-menu-toggle" href="#" title="Switch between light and dark themes">
          <span class="sr-only">Switch between light and dark themes</span>
          <i class="w-7 h-7" id="theme-toggle-icon"></i>
        </a>
        <a id="navigation-menu-toggle" class="p-2 inline-block text-base no-underline focus:outline-none focus:ring-2 focus:ring-secondary-darker dark:focus:ring-white lg:hidden" role="button" aria-owns="main-menu" aria-controls="main-menu" aria-expanded="false" href="#main-menu">
          <span class="sr-only">Toggle main navigation</span>
          <i class="navigation-menu-icon w-7 h-7 dark:filter dark:invert" id="navigation-toggle-icon"></i>
        </a>
      </div>
      <div id="main-menu" class="flex flex-grow mt-4 hidden targeted:block lg:block lg:w-auto lg:mt-0" aria-labelledby="navigation-menu-toggle">
  <div class="container mx-auto">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-end">
      <nav role="navigation" itemscope itemtype="https://schema.org/SiteNavigationElement">
        <ul class="ml-auto mb-2 lg:mb-0">
          
          <li class="list-none lg:inline-block" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a class="py-2 inline-block no-underline hover:text-gray-900 hover:underline dark:hover:text-white lg:p-2 lg:mr-2" href="/en/stories" itemprop="item">
              <span class="text-base dark:text-white" itemprop="name">All Stories</span>
            </a>
          </li>
          
        </ul>
      </nav>
      <div itemscope itemtype="https://schema.org/WebSite">
  <form class="inline-search flex p-2 mb-2 border-2 rounded-lg dark:bg-white lg:mb-0" itemprop="potentialAction" itemscope itemtype="https://schema.org/SearchAction" action="/en/search/" role="search" method="get">
    <meta itemprop="target" content="https://www.automacaodedados.com.br/en/search/">
    <label class="sr-only" for="q">Search stories</label>
    <input class="text-sm px-4 w-full focus:outline-none focus:border-transparent dark:text-gray-900" itemprop="query" id="q" name="q" type="search" aria-label="Search the entire website" placeholder='Search stories'>
    <button class="p-2 text-base focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary-darker" type="submit">
      <span class="sr-only">Start search</span>
      <i class="search-icon w-4 h-4"></i>
    </button>
  </form>
</div>

    </div>
  </div>
</div>

    </div>
  </div>
</header>

      <main id="content" class="flex-grow">
        


<article role="article" itemscope itemtype="https://schema.org/Article">
  <header>

  


  
  
  
  
  
<div class="relative py-8">
  
    
  <div class="absolute inset-0 bg-cover bg-center filter brightness-75" style="background-image: url('/en/stories/configurando-metabase-e-postgresql-no-docker/images/thumbnail_hu46ba3eab324bd3b57676d5fcac380c13_42865_1024x400_fill_q75_box_smart1.jpg');"></div>
  
  <div class="relative container container-box mx-auto">
    <div class="flex justify-between items-center mb-6 px-2">
      <div class="flex flex-col lg:flex-row">
        
        <address class="text-white text-base" itemprop="author">Henrique</address>
        <time class="text-white text-base lg:ml-2" pubdate datetime="2020-11-17 09:10:00 &#43;0000 UTC" itemprop="datePublished">17/11/2020 09:10:00</time>
        
      </div>
      <a class="badge dark:ring-offset-secondary-darker" href="/en/categories/automation" itemprop="articleSection">automation</a>
    </div>
    <div class="flex flex-col px-2">
      
      <div>
        <h1 class="text-white text-5xl break-words lg:text-6xl lg:break-normal" itemprop="headline">Setting up Metabase and PostgreSQL with Docker</h1>
      </div>
      <div>
        
        <p class="text-white text-2xl" itemprop="abstract">How to built a simple service architecture, easy to maintain and portable using Docker? Throughout this post, you&rsquo;ll discover how to do that integrating a PostgreSQL database with Metabase</p>
        
      </div>
      
    </div>
  </div>
</div>



  </header>
  <div class="bg-secondary hidden dark:bg-neutral lg:block">
    <div class="container container-box mx-auto">
      <div class="px-2">
      <nav aria-label="Breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
  <ul class="flex ml-auto mb-0">
    
  
    
  
    
  

  
  <li class="flex relative pr-7 last:pr-0 dark:filter dark:invert" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-gray-100" href="/en/" itemprop="item">
      
      <span class="text-white" itemprop="name">Home</span>
      
    </a>
    <i class="breadcrumb-separator"></i>
  </li>
  

  

  
  <li class="flex relative pr-7 last:pr-0 dark:filter dark:invert" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-gray-100" href="/en/stories/" itemprop="item">
      
        <span class="text-white" itemprop="name">All stories</span>
      
    </a>
    <i class="breadcrumb-separator"></i>
  </li>
  

  

  
  <li class="flex relative pr-7 last:pr-0 dark:filter dark:invert" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-gray-100" href="/en/stories/configurando-metabase-e-postgresql-no-docker/" aria-current="page" itemprop="item">
      <span class="text-white" itemprop="name">Setting up Metabase and PostgreSQL with Docker</span>
    </a>
  </li>
  

  </ul>
</nav>



      </div>
    </div>
  </div>
  <div class="container container-box mx-auto">
    <div class="max-w-3xl px-2 mx-auto flex flex-col">
      <main id="post" itemprop="articleBody">
        <strong class="inline-block text-base mb-4 dark:text-white">Estimated time to read: 13 minutes</strong>
        <p>Published on November 17, 2020 and updated on November 20, 2021.</p>
<h2 id="isolating-environments-with-docker">Isolating environments with Docker</h2>
<p>A infrastructure that scale as demand increase is essential for any digital product with reach. The ability to scale depends on many things, from the technical specifications used by server machines to the chosen architecture. One of these variables, topic to be discussed in this post, is the configuration for the environment. A well planned environment is easy to maintain and change, helping to avoid &ndash; or to reduce the impact &ndash; of a maintenance, being it scheduled or not.</p>
<p>You&rsquo;ll probably already saw this problem: the same software is developed in one machine, stored in a repository on another machine, copied and modified on other five machines by developers, merged in the repository, moved to a staging server and then moved again to the production environment. There are many machines, many configurations and possibly the software that worked at some of these machines may not work on others. Hours from developers are spent trying to find the source of the error after the deploy, just to find out that it was a matter of changing the version used by the programming language or the database that is installed on the production machine. Problem solved, it is time to mirror the same configuration on all machines used for development. It happens that the software will now use a new dependency, which requires some new configuration in the environment in which it is hosted. If this configuration is missing at any single one of these machines used for development, the app won&rsquo;t work as expected, and more time from developers will be spent to correct the problem.</p>
<p>It is to solve problems like these that <strong>Docker</strong> exists, a container manager. A container is an isolated environment. Isolation is achieved by ensuring that, inside the environment, all the necessary tools that make the app work are available and use the correct versions. Docker use configuration files called <strong>Dockerfiles</strong>, which determine the set of configurations for each environment. These files are portable, they can be copied into different machines so the exact environment can be replicated in a new machine, disregarding the differences among machines.</p>
<p>Let&rsquo;s explore Docker, one example of a Dockerfile and find out how to manage more than one container, or environment.</p>
<h2 id="docker-installation">Docker installation</h2>
<p>The first step is to install Docker on your computer. Docker can be downloaded on its <a href="https://www.docker.com/" target="_blank" rel="noopener">official website</a>. Once Docker is installed, open a console and type the following command (if you&rsquo;re using Linux, you may need to use sudo to grant root level permissions to Docker):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker --version</code></pre></td></tr></table>
</div>
</div>
<p>If Docker is installed, you should see on the screen which version of Docker is installed. The next step is to install <a href="https://docs.docker.com/compose/install/" target="_blank" rel="noopener">Docker Compose</a>, a Docker utility that ease managing multiple containers. Download and install Docker Compose on your computer. Next, open a terminal and type the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker-compose --version</code></pre></td></tr></table>
</div>
</div>
<p>If Docker Compose is installed, you will see on the screen which version of Docker Compose is installed.</p>
<figure >
  
  <img data-src="images/figure1-docker-and-docker-compose-installed.webp" class="lazy" alt="Docker and Docker Compose versions installed on my machine." title="Docker and Docker Compose versions installed on my machine." />
  
  
  <figcaption>
    <p>Docker and Docker Compose versions installed on my machine. Source: Author.</p>
  </figcaption>
  
</figure>

<h2 id="download-the-images">Download the images</h2>
<p>Now that Docker is installed on the machine, we can create the containers which we&rsquo;ll use in this tutorial: one with <a href="https://www.metabase.com/" target="_blank" rel="noopener">Metabase</a> and another one with <a href="https://www.postgresql.org/" target="_blank" rel="noopener">PostgreSQL</a>.</p>
<p>Beyond ensuring a controlled environment for hosting software, another great advantage of Docker is its portability. You can create and configure an environment and share with other people so they don&rsquo;t have to do the same work from scratch. This is so common among Docker community that there is even a repository with templates for environments ready to be used, called <a href="https://hub.docker.com/" target="_blank" rel="noopener">Docker Hub</a>. These environment templates are called <strong>images</strong>. An image have all files and tools necessary for the environment to work in isolation. Images are like the plant of a house while the house is a container. It is based on the image that the container is created. There are official images for many popular apps including WordPress, MySQL or Node.js and other images that were created by people from Docker community.</p>
<p>We&rsquo;ll use two images: one from <a href="https://hub.docker.com/r/metabase/metabase" target="_blank" rel="noopener">Metabase</a> and one from <a href="https://hub.docker.com/_/postgres" target="_blank" rel="noopener">PostgreSQL</a>. It is necessary to download both images from Docker Hub. To download the PostgreSQL image, open a terminal and type the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker pull postgres</code></pre></td></tr></table>
</div>
</div>
<p>You can check out the download progress using the terminal. Once this is finished, download the image from Metabase typing the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker pull metabase/metabase</code></pre></td></tr></table>
</div>
</div>
<p>Each image available on Docker Hub have a version, and the latest version is identified by a tag called latest. It is this version that is downloaded by default when no tag is specified. You may need different versions for apps that need to run on tools with specific versions. <a href="https://www.mautic.org/" >Mautic</a>, a marketing automation tool, is an example of such app, which by the time this post was published it don&rsquo;t work with PHP 7.3 or above, so the environment must have at most PHP 7.2. Each image on Docker Hub have a page with instructions on how to download each version of an image.</p>
<p>With all images ready to be used on your machine, it is time to configure the containers.</p>
<h2 id="creating-a-container">Creating a container</h2>
<p>To use the images it is necessary to inform Docker how they will be used. You can use each image as it was downloaded from the repository or modify it before creating the container. If using the image the way it was downloaded, Docker know what it needs to do and you can simply create a container. To create a container using the Metabase image, for instance, just run the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker run -p 3000:3000 metabase/metabase</code></pre></td></tr></table>
</div>
</div>
<p>A new container is created with the command run and some arguments. The only required argument is the name of the image that will be used to generate a container. For Metabase to be accessible, it is necessary to map a port from your machine to a port from the container. This is done by using the flag &ldquo;p&rdquo;. The first specified port is one from your machine and the second one is from the container, separated by colons (:). <strong>Make sure port 3000 on your machine is free, otherwise use a door that is free</strong>.</p>
<p>By default, the container running Metabase expose port 3000. Open a browser and type localhost:3000. You should see a screen to setup Metabase. Since we&rsquo;ll use Metabase along with PostgreSQL, shutdown the connection between the terminal and the container by accessing the terminal and making a forced stop with shortcut CTRL + C. This stop just closed the connection between the terminal and the container, but the container is still running. It needs to be stopped so the port 3000 gets released. To do that, we&rsquo;ll list all containers that are running with the command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker ps</code></pre></td></tr></table>
</div>
</div>
<p>See in the terminal that the last column is called name. This column identifies each container created, and these names are automatically generated if not specified. Each time you create a new container, Docker will give a random name for that container. You can specify the name using the flag &ldquo;name&rdquo;. For now, shutdown the container with the command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker stop container_name</code></pre></td></tr></table>
</div>
</div>
<p>Where container_name is the name Docker gave to the newly created container, which is different from the name of the image.</p>
<h2 id="creating-a-dockerfile">Creating a Dockerfile</h2>
<p>You can modify an image downloaded from a repository or create an image from scratch. For that, you&rsquo;ll need to create a file called <strong>Dockerfile</strong> and configure it. Once the file is configured, you must inform Docker how to find this file and execute all commands that will create a new image.</p>
<p>To create a new image, create a folder in any directory from your computer and, right after, open a notepad. With the notepad opened, type the following lines:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="k">FROM</span><span class="s"> metabase/metabase:latest</span><span class="err">
</span><span class="err"></span><span class="k">LABEL</span> <span class="nv">Description</span><span class="o">=</span><span class="s2">&#34;This is a custom build based on the official Metabase image.&#34;</span></code></pre></td></tr></table>
</div>
</div>
<p>Save the file in the directory created with the name Dockerfile. This Dockerfile have only two instructions:</p>
<ul>
<li>Use the most recent version of the base image from Metabase (if the image hadn&rsquo;t been downloaded, Docker would have tried to download the image from the repository);</li>
<li>Describe the environment.</li>
</ul>
<p>There are many commands that can be used in a Dockerfile, useful to do things like add other dependencies to an environment. The complete list of commands can be found at <a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">the official Docker documentation</a>.</p>
<p>Open a terminal and type the following commands, remembering to alter the code so that the directory is the one in your machine where there&rsquo;s a Dockerfile:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /path/to/Dockerfile
docker build --tag latest metabase_sandbox .</code></pre></td></tr></table>
</div>
</div>
<p>Inspecting this code:</p>
<ul>
<li>Command cd is used to browse the structure of files and folders. The path to be typed should be the one where there&rsquo;s a newly created Dockerfile;</li>
<li>Command build create a new image based on the image specified in the Dockerfile. The flag &ldquo;tag&rdquo; specify that a tag called latest should be added to the image, the name of the image will be metabase_sandbox and the path to the Dockerfile is the current directory (note the period after the name of the image, separated by an empty space. If the Dockerfile was in another directory the period would need to be replaced with the path to the Dockerfile).</li>
</ul>
<p>You can check out each step on the creating of the image in your terminal. At the end, run the following command on the terminal:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker image ls</code></pre></td></tr></table>
</div>
</div>
<p>All images that you have on your computer will be shown on the terminal, including the newly created one, called metabase_sandbox. Test this new image running the command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker run -p 3000:3000 metabase_sandbox</code></pre></td></tr></table>
</div>
</div>
<p>The result should be the same as when you created a container directly from the original image. Open a browser and type localhost:3000. The same Metabase configuration screen will appear.</p>
<p>Close the connection between the terminal and the container using CTRL + C. All images and containers created use physical space on your computer and you can save space by deleting everything that won&rsquo;t be used anymore. To do the cleaning, start by typing the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker ps -a</code></pre></td></tr></table>
</div>
</div>
<p>Command ps will show all containers that were created, and flag &ldquo;a&rdquo; will also show all containers that aren&rsquo;t running. To delete the newly created container run the command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker rm container_name</code></pre></td></tr></table>
</div>
</div>
<p>Where container_name is the name that Docker automatically gave after its creation or the name you gave by specifying the flag &ldquo;name&rdquo; when using the command run. The container will be deleted from your system. You can make the process of deleting a container automatic by appending the flag &ldquo;rm&rdquo; to run. This way, the container will be automatically deleted once it is shutdown.</p>
<p>Delete also the image metabase_sandbox. For that, with all containers that make use of this image stopped, run the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker image rm metabase_sandbox</code></pre></td></tr></table>
</div>
</div>
<p>You can check that the image doesn&rsquo;t exist anymore by running the command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker image ls</code></pre></td></tr></table>
</div>
</div>
<p>A Dockerfile is necessary to customize an existing image or creating one from scratch, but what when we need more than one service and these services have dependencies among themselves?</p>
<h2 id="multiple-containers-in-docker-with-docker-compose">Multiple containers in Docker with Docker Compose</h2>
<p>There are tools designed specifically to work with multiple Docker containers. We&rsquo;ll use one tool that does that to centralize all environment configurations in a single place, and this tool is <strong>Docker Compose</strong>. Docker Compose uses a single file to configure all containers, and each container can have its own Dockerfile if necessary. This file used by Docker Container is called <strong>docker-compose.yml</strong> and it is written using <a href="https://en.wikipedia.org/wiki/YAML" target="_blank" rel="noopener">yaml</a>. We&rsquo;ll create this file in the same directory in which the Dockerfile was created prior. Access this directory and create a new text file using this code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3.8&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span><span class="w">	</span><span class="nt">db</span><span class="p">:</span><span class="w">
</span><span class="w">    		</span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">postgres</span><span class="w">
</span><span class="w">    		</span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">postgresql_metabase</span><span class="w">
</span><span class="w">    		</span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span><span class="w">    		</span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">        		</span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l">metabase</span><span class="w">
</span><span class="w">        		</span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l">metabase</span><span class="w">
</span><span class="w">        		</span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l">db_password</span><span class="w">
</span><span class="w">    		</span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">        		</span>- <span class="l">db_data:/var/lib/postgresql/data</span><span class="w">
</span><span class="w">    		</span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">      	  	</span>- <span class="m">5432</span><span class="p">:</span><span class="m">5432</span><span class="w">
</span><span class="w">
</span><span class="w">	</span><span class="nt">dataviz</span><span class="p">:</span><span class="w">
</span><span class="w">    		</span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">metabase/metabase</span><span class="w">
</span><span class="w">    		</span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">metabase</span><span class="w">
</span><span class="w">    		</span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span><span class="w">    		</span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span><span class="w">     	   	</span><span class="nt">MB_DB_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l">postgres</span><span class="w">
</span><span class="w">       	 	</span><span class="nt">MB_DB_DBNAME</span><span class="p">:</span><span class="w"> </span><span class="l">metabase</span><span class="w">
</span><span class="w">       	 	</span><span class="nt">MB_DB_PORT</span><span class="p">:</span><span class="w"> </span><span class="m">5432</span><span class="w">
</span><span class="w">        		</span><span class="nt">MB_DB_USER</span><span class="p">:</span><span class="w"> </span><span class="l">metabase</span><span class="w">
</span><span class="w">        		</span><span class="nt">MB_DB_PASS</span><span class="p">:</span><span class="w"> </span><span class="l">db_password</span><span class="w">
</span><span class="w">       	 	</span><span class="nt">MB_DB_HOST</span><span class="p">:</span><span class="w"> </span><span class="l">db</span><span class="w">
</span><span class="w">       	 	</span><span class="nt">MB_DB_FILE</span><span class="p">:</span><span class="w"> </span><span class="l">/metabase-data/metabase.db</span><span class="w">
</span><span class="w">    		</span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span><span class="w">      	  	</span>- <span class="l">db</span><span class="w">
</span><span class="w">    		</span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">       	 	</span>- <span class="l">dataviz_data:/metabase-data</span><span class="w">
</span><span class="w">    		</span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span><span class="w">       	 	</span>- <span class="m">3000</span><span class="p">:</span><span class="m">3000</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">	</span><span class="nt">db_data</span><span class="p">:</span><span class="w">
</span><span class="w">	</span><span class="l">dataviz_data:</span></code></pre></td></tr></table>
</div>
</div>
<p>There are many configurations in this file. This could all be done in separate Dockerfiles, except establishing a relationship among both containers. What this file is doing is:</p>
<ul>
<li>Specify which language version will be used in this file is 3.8. All docker-compose.yml files must specify at their first lines which version that they use. The most recent by the time this post was published is 3.8;</li>
<li>Create two services: one called db and another one called dataviz. Services in this context are containers and their respective configurations;</li>
<li>Create two <strong>volumes</strong>, repositories that store data created inside containers. Every time that a container is shutdown, all data is lost and volumes prevent this from happening. These volumes were just declared. Upon defining each service, the volumes will be used to map directories on both the local machine and the container, so files created are shared between the container and the machine. Docker have a default directory to store volumes, but you can use any other directory in your computer. It is important to note that volumes with declared directories will assume that this directory exist on every machine in which docker-compose.yml is installed, if don&rsquo;t an error will occur when creating the containers.</li>
</ul>
<p>Each service have several configurations. The service db:</p>
<ul>
<li>Use the image Postgres. Since there&rsquo;s no version specified, the lastest one is assumed, The container is named postgresql_metabase and is configured to be destroyed every time the container is shutdown;</li>
<li>Three environment variables are defined. One of many options when creating images is to declare environment variables, which can be modified. The Postgres image have many variables, and three of them are used when creating the container: POSTGRES_DB, POSTGRES_USER and POSTGRES_PASSWORD. These variables will be used to create a default database, user and password respectively. These access credentials will be used on Metabase later on to establish the connection with the database;</li>
<li>Volume db_data is synchronized with the directory that store databases in PostgreSQL;</li>
<li>Port 5432 is exposed on both the machine and the container to access the database.</li>
</ul>
<p>And the service dataviz:</p>
<ul>
<li>Use the Metabase image previously downloaded;</li>
<li>Specify that the container will be named metabase;</li>
<li>Inform that the container should be removed once it is shutdown;</li>
<li>Declare several environment variables that are used within this image of Metabase. These variables inform Metabase where the database is, which access credentials should it use and where, inside the container, will be stored the data file created by Metabase, at the variable MB_DB_FILE;</li>
<li>Specify that the container depends on the service db. Docker should initialize first the container postgresql_metabase before initializing metabase;</li>
<li>Specify a volume to store the data files created by Metabase;</li>
<li>Expose port 3000 on both the machine and container.</li>
</ul>
<p>Save the file with name docker-compose.yml. Note that we didn&rsquo;t used the Dockerfile previously created, but it is possible to specify its address inside docker-compose.yml if it is necessary to customize the image. We&rsquo;ll use the default images, setting up only the environment variables from each container, volumes to specify where to save data that can&rsquo;t be lost upon shutting down the container and the order of initialization.</p>
<p>Open a terminal and, in the directory in which there&rsquo;s a docker-compose.yml, type the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">docker-compose up</code></pre></td></tr></table>
</div>
</div>
<p>Once the command is executed, both containers initialized. Browse to localhost:3000 and start the process of configuring Metabase. After setting up the database, select the option others and type the same data that were used to fill the environment variables for both Metabase and PostgreSQL. In the host field just type the name of the service created at docker-compose.yml, named db. Finish the configuration and, at the home screen of Metabase, you should see a database with some tables created next to the default database.</p>
<figure >
  
  <img data-src="images/figure2-metabase-home-page.webp" class="lazy" alt="Database Metabase, created on PostgreSQL, connected to Metabase." title="Database Metabase, created on PostgreSQL, connected to Metabase." />
  
  
  <figcaption>
    <p>Database Metabase, created on PostgreSQL, connected to Metabase. Source: Author.</p>
  </figcaption>
  
</figure>

<h2 id="considerations">Considerations</h2>
<p>This is a simple architecture with two containers, but one architecture can have dozens or hundreds of services that are connected with one another to make a product work, as the need of each company. Even this architecture could have been done differently. I recommend reading the documentation of <a href="https://docs.docker.com/" target="_blank" rel="noopener">Docker</a> and <a href="https://docs.docker.com/compose/" target="_blank" rel="noopener">Docker Compose</a> to explore all possibilities when configuring containers.</p>
<p>Infrastructures with many machines and apps on distributed environments use tools such as <a href="https://kubernetes.io/" target="_blank" rel="noopener">Kubernetes</a>, designed for such scenario.</p>
<p>Let&rsquo;s configure environments!</p>

      </main>
      <footer>
        


<div class="h-1 w-16 my-6 bg-gray-900 mx-auto dark:bg-white"></div>
<div class="flex justify-center items-center" itemprop="author" itemscope itemtype="https://schema.org/Person">
  <div class="mr-4 w-3/12 md:w-2/12">
    <img class="rounded-full" src="/images/profiles/henriquesouza/profile.webp" alt="Henrique Freitas Souza" itemprop="image">
  </div>
  <div class="w-9/12 md:w-10/12">
    <address class="font-title dark:text-white" itemprop="name">Henrique Freitas Souza</address>
    
    <p class="mb-auto text-base dark:text-white" itemprop="description">Once I&#39;ve read that data is like nuclear waste. Since then I&#39;m extra careful when using them.</p>
    
  </div>
</div>


      </footer>
    </div>
  </div>
</article>

  
  
<div class="container container-box mx-auto">
  <div class="px-2 lg:px-0">
    <aside role="complementary">
      <span class="inline-block w-full font-title text-3xl text-center mb-4 px-2 dark:text-white">You should also read these stories</span>
      <div class="lg:flex lg:flex-wrap lg:justify-start">
        
          




<div class="mb-4 lg:mb-0 lg:p-2 lg:w-1/2 xl:w-1/3">
  <article class="relative flex flex-col bg-gray-300 p-6 h-full rounded-lg dark:bg-secondary-darker" role="article" itemscope itemtype="https://schema.org/Article">
  
    
    <div class="absolute inset-0 bg-cover bg-center filter brightness-50 rounded-lg" style="background-image: url('/en/stories/rd-station-e-google-sheets-na-aws/images/thumbnail_hu4a2eaaaa0922d32f9b411fc58706e27f_32210_500x500_fill_q75_box_smart1.jpg');"></div>
  
    <header class="relative flex flex-wrap justify-between items-center mb-6">
      
      <div>
        <address class="text-white text-base" itemprop="author">Henrique</address>
        <time class="text-white text-base" itemprop="datePublished" pubdate datetime="2020-09-03 19:23:00 &#43;0000 UTC">03/09/2020 19:23:00</time>
      </div>
      <a href="/en/categories/automation" class="badge" itemprop="articleSection">automation</a>
      
    </header>
    <main class="relative" itemprop="articleBody">
      
      <h2 class="text-white" itemprop="headline">RD Station and Google Sheets Part 2 - Moving to AWS</h2>
      <p class="mb-6 text-white" itemprop="abstract">We saw before on this blog how to send leads from RD Station to a spreadsheet automatically. Now we will see how to send these same leads to a database hosted on AWS</p>
      <div>
        <a class="button-primary" href="/en/stories/rd-station-e-google-sheets-na-aws/">Read more</a>
      </div>
      
    </main>
  </article>
</div>

        
          




<div class="mb-4 lg:mb-0 lg:p-2 lg:w-1/2 xl:w-1/3">
  <article class="relative flex flex-col bg-gray-300 p-6 h-full rounded-lg dark:bg-secondary-darker" role="article" itemscope itemtype="https://schema.org/Article">
  
    
    <div class="absolute inset-0 bg-cover bg-center filter brightness-50 rounded-lg" style="background-image: url('/en/stories/rd-station-e-google-sheets/images/thumbnail_hu9a8e1eb5a7452283d6f6255f788ec07e_26449_500x500_fill_q75_box_smart1.jpg');"></div>
  
    <header class="relative flex flex-wrap justify-between items-center mb-6">
      
      <div>
        <address class="text-white text-base" itemprop="author">Henrique</address>
        <time class="text-white text-base" itemprop="datePublished" pubdate datetime="2018-09-02 14:07:00 &#43;0000 UTC">02/09/2018 14:07:00</time>
      </div>
      <a href="/en/categories/automation" class="badge" itemprop="articleSection">automation</a>
      
    </header>
    <main class="relative" itemprop="articleBody">
      
      <h2 class="text-white" itemprop="headline">RD Station and Google Sheets: automatically exporting leads to spreadsheets</h2>
      <p class="mb-6 text-white" itemprop="abstract">Get to know how to automatically send leads to Google Sheets from RD Station, a marketing automation software</p>
      <div>
        <a class="button-primary" href="/en/stories/rd-station-e-google-sheets/">Read more</a>
      </div>
      
    </main>
  </article>
</div>

        
          




<div class="mb-4 lg:mb-0 lg:p-2 lg:w-1/2 xl:w-1/3">
  <article class="relative flex flex-col bg-gray-300 p-6 h-full rounded-lg dark:bg-secondary-darker" role="article" itemscope itemtype="https://schema.org/Article">
  
    
    <div class="absolute inset-0 bg-cover bg-center filter brightness-50 rounded-lg" style="background-image: url('/en/stories/apis-e-carrinhos-de-supermercado/images/thumbnail_hu46c54be97ab545b46d52504c6747000a_184568_500x500_fill_q75_box_smart1.jpg');"></div>
  
    <header class="relative flex flex-wrap justify-between items-center mb-6">
      
      <div>
        <address class="text-white text-base" itemprop="author">Henrique</address>
        <time class="text-white text-base" itemprop="datePublished" pubdate datetime="2018-07-04 21:20:00 &#43;0000 UTC">04/07/2018 21:20:00</time>
      </div>
      <a href="/en/categories/automation" class="badge" itemprop="articleSection">automation</a>
      
    </header>
    <main class="relative" itemprop="articleBody">
      
      <h2 class="text-white" itemprop="headline">APIs and grocery carts</h2>
      <p class="mb-6 text-white" itemprop="abstract">What is an API and what it is for? This post will introduce it without using technical language.</p>
      <div>
        <a class="button-primary" href="/en/stories/apis-e-carrinhos-de-supermercado/">Read more</a>
      </div>
      
    </main>
  </article>
</div>

        
      </div>
    </aside>
  </div>
</div>
  


      </main>
      <footer>
        <div class="bg-secondary-darker">
  <div class="container container-box mx-auto">
    <div class="flex flex-wrap justify-between px-2 lg:px-0">
      <div class="w-full mb-6 last:mb-auto lg:mb-auto lg:p-2 lg:w-2/4">
        <div class="flex items-center mb-4">
          <img src="https://www.automacaodedados.com.br/images/automacaodedados_logo_white.svg" alt="Logo Data Automation" class="mr-2 w-16 h-8">
          <span class="font-title inline-block text-white text-base">Data Automation</span>
        </div>
        <p class="text-white">Space to publish information that help democratize knowledge about new technologies in Brazil.</p>
      </div>
      <div class="w-full mb-6 last:mb-auto lg:mb-auto lg:p-2 lg:w-1/4">
  <span class="font-title inline-block mb-4 text-white text-base">All categories</span>
  <nav role="navigation" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul class="list-none ml-auto">
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/categories/analysis/" itemprop="item">
          <span class="text-white" itemprop="name">Analysis</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/categories/analytics/" itemprop="item">
          <span class="text-white" itemprop="name">Analytics</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/categories/automation/" itemprop="item">
          <span class="text-white" itemprop="name">Automation</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/categories/design/" itemprop="item">
          <span class="text-white" itemprop="name">Design</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/categories/development/" itemprop="item">
          <span class="text-white" itemprop="name">Development</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/categories/entrepreneurship/" itemprop="item">
          <span class="text-white" itemprop="name">Entrepreneurship</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/categories/governance/" itemprop="item">
          <span class="text-white" itemprop="name">Governance</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/categories/marketing/" itemprop="item">
          <span class="text-white" itemprop="name">Marketing</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/categories/statistics/" itemprop="item">
          <span class="text-white" itemprop="name">Statistics</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/categories/visualization/" itemprop="item">
          <span class="text-white" itemprop="name">Visualization</span>
        </a>
      </li>
      
    </ul>
  </nav>
</div>
<div class="w-full mb-6 last:mb-auto lg:mb-auto lg:p-2 lg:w-1/4">
  <span class="font-title inline-block mb-4 text-white text-base">Latest stories</span>
  <nav role="navigation" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul class="list-none ml-auto">
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/stories/o-metaverso-pos-meta/" itemprop="item">
          <span class="text-white" itemprop="name">The Metaverse post Meta</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/stories/construcao-da-identidade-no-espaco-virtual/" itemprop="item">
          <span class="text-white" itemprop="name">Identity development in the digital space</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="/en/stories/como-escolher-o-melhor-grafico/" itemprop="item">
          <span class="text-white" itemprop="name">How to choose the best chart?</span>
        </a>
      </li>
      
    </ul>
  </nav>
</div>

    </div>
  </div>
</div>
<div class="bg-gray-300">
  <div class="container container-box mx-auto">
    <div class="text-center lg:flex lg:justify-between lg:items-center lg:text-left px-2">
      <span class="inline-block text-base dark:text-gray-900">Made with Hugo &#43; Tailwind and hosted on Github Pages.</span>
      <div itemscope itemtype="https://schema.org/Language">
        <ul class="ml-auto mb-0">
          
          <li class="inline-block" itemprop="availableLanguage" itemscope itemtype="https://schema.org/Language">
            <a class="px-2 py-1 text-base no-underline hover:text-gray-900 hover:underline dark:text-gray-900 dark:hover:text-gray-900" href="/" itemprop="name">ð§ð· PortuguÃªs</a>
          </li>
          
          <li class="inline-block" itemprop="availableLanguage" itemscope itemtype="https://schema.org/Language">
            <a class="px-2 py-1 text-base no-underline hover:text-gray-900 hover:underline dark:text-gray-900 dark:hover:text-gray-900" href="/en/" itemprop="name">ðºð¸ English</a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
</div>

      </footer>
    </div>
    <script src="/js/theme.min.js"></script>

    
<script src="/js/lazy.min.js" async></script>

  </body>
</html>
