<!DOCTYPE html>
<html class="" lang="pt" dir="ltr">
  <head>
    <title>Google Apps Script com OAuth2 | Automação de Dados</title>

<meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Google Apps Script com OAuth2 | Automação de Dados" />

<meta property="og:url" content="https://www.automacaodedados.com.br/stories/google-apps-script-com-oauth2/">
<meta property="og:locale" content="pt" />
<meta property="og:title" content="Google Apps Script com OAuth2 | Automação de Dados">
<meta property="og:description" content="Google Apps Script com OAuth2 | Automação de Dados">
<meta property="og:site_name" content="Automação de Dados">

<meta name="twitter:card" content="summary_large_image">


<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-01-29 14:42:00 &#43;0000 UTC" />
<meta property="article:modified_time" content="2021-11-07 14:42:00 &#43;0000 UTC" />
<meta name="twitter:label1" content="Tempo estimado para a leitura" />
<meta name="twitter:data1" content="18 minutos" />



<meta property="og:image" content="https://www.automacaodedados.com.br/stories/google-apps-script-com-oauth2/images/thumbnail.jpg">
<meta name="twitter:image" content="https://www.automacaodedados.com.br/stories/google-apps-script-com-oauth2/images/thumbnail.jpg">
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="400" />

<meta name="og:image:alt" content="Fluxo de autenticação OAuth2.">

    <link href="https://www.automacaodedados.com.br/images/favicon.ico" rel="icon" type="image/x-icon" />

	
	<link rel="alternate" hreflang="en" href="https://www.automacaodedados.com.br/en/stories/google-apps-script-com-oauth2/" title="English">
	

<link rel="preload" as="script" href="/js/ui.min.js" />
<link rel="preload" as="script" href="/js/theme.min.js" />
<link rel="preload" as="style" href="/css/fonts.min.css" />
<link rel="preload" as="style" href="/css/main.min.css" />
<link rel="stylesheet" href="/css/fonts.min.css" />
<link rel="stylesheet" href="/css/main.min.css" />
<script src="/js/ui.min.js" async></script>

    
  </head>
  <body class="overflow-x-hidden dark:bg-secondary">
    <div class="flex flex-col h-screen">
      <a class="sr-only focus:sr-only" href="#content">Pular para o conteúdo</a>
      <header class="flex flex-col justify:between">
  <div class="container container-box mx-auto lg:px-0">
    <div class="px-2 flex flex-wrap justify-between items-center">
      <div class="w-6/12 md:w-auto">
        <a href="/" class="flex items-center mr-2 font-title no-underline hover:no-underline focus:outline-none focus:ring-2 focus:ring-offset-8 focus:ring-secondary-darker dark:ring-offset-secondary dark:ring-white">
          <img class="mr-2 w-16 h-8" id="site-logo" src="https://www.automacaodedados.com.br/images/automacaodedados_logo.svg" alt="Logo Automação de Dados">
          <span class="text-base font-title leading-none mb-0 break-words dark:text-white">Automação de Dados</span>
        </a>
      </div>
      <div class="flex items-center lg:order-last">
        <a class="p-2 mr-2 inline-block no-underline focus:outline-none focus:ring-2 focus:ring-secondary-darker dark:focus:ring-white lg:mr-0 lg:ml-2" id="theme-menu-toggle" href="#" title="Trocar entre temas escuro e claro">
          <span class="sr-only">Trocar entre temas escuro e claro</span>
          <i class="w-7 h-7" id="theme-toggle-icon"></i>
        </a>
        <a id="navigation-menu-toggle" class="p-2 inline-block text-base no-underline focus:outline-none focus:ring-2 focus:ring-secondary-darker dark:focus:ring-white lg:hidden" role="button" aria-owns="main-menu" aria-controls="main-menu" aria-expanded="false" href="#main-menu">
          <span class="sr-only">Abrir e fechar navegação principal</span>
          <i class="navigation-menu-icon w-7 h-7 dark:filter dark:invert" id="navigation-toggle-icon"></i>
        </a>
      </div>
      <div id="main-menu" class="flex flex-grow mt-4 hidden targeted:block lg:block lg:w-auto lg:mt-0" aria-labelledby="navigation-menu-toggle">
  <div class="container mx-auto">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-end">
      <nav role="navigation" itemscope itemtype="https://schema.org/SiteNavigationElement">
        <ul class="ml-auto mb-2 lg:mb-0">
          
          <li class="list-none lg:inline-block" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a class="py-2 inline-block no-underline hover:text-gray-900 hover:underline dark:hover:text-white lg:p-2 lg:mr-2" href="https://www.automacaodedados.com.br/stories" itemprop="item">
              <span class="text-base dark:text-white" itemprop="name">Todas as Histórias</span>
            </a>
          </li>
          
        </ul>
      </nav>
      <div itemscope itemtype="https://schema.org/WebSite">
  <form class="inline-search flex p-2 mb-2 border-2 rounded-lg dark:bg-white lg:mb-0" itemprop="potentialAction" itemscope itemtype="https://schema.org/SearchAction" action="https://www.automacaodedados.com.br/search/" role="search" method="get">
    <meta itemprop="target" content="https://www.automacaodedados.com.br/search/">
    <label class="sr-only" for="q">Buscar histórias</label>
    <input class="text-sm px-4 w-full focus:outline-none focus:border-transparent dark:text-gray-900" itemprop="query" id="q" name="q" type="search" aria-label="Buscar em todo o site" placeholder='Buscar histórias'>
    <button class="p-2 text-base focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary-darker" type="submit">
      <span class="sr-only">Iniciar a busca</span>
      <i class="search-icon w-4 h-4"></i>
    </button>
  </form>
</div>

    </div>
  </div>
</div>

    </div>
  </div>
</header>

      <main id="content" class="flex-grow">
        


<article role="article" itemscope itemtype="https://schema.org/Article">
  <header>

  


  
  
  
  
  
<div class="relative py-8">
  
    
  <div class="absolute inset-0 bg-cover bg-center filter brightness-75" style="background-image: url('https://www.automacaodedados.com.br/stories/google-apps-script-com-oauth2/images/thumbnail_huae1c884c85eba8321296d9a909c79aac_36559_1024x400_fill_q75_box_smart1.jpg');"></div>
  
  <div class="relative container container-box mx-auto">
    <div class="flex justify-between items-center mb-6 px-2">
      <div class="flex flex-col lg:flex-row">
        
        <address class="text-white text-base" itemprop="author">Henrique</address>
        <time class="text-white text-base lg:ml-2" pubdate datetime="2018-01-29 14:42:00 &#43;0000 UTC" itemprop="datePublished">29/01/2018 14:42:00</time>
        
      </div>
      <a class="badge dark:ring-offset-secondary-darker" href="https://www.automacaodedados.com.br/categories/automa%C3%A7%C3%A3o" itemprop="articleSection">automação</a>
    </div>
    <div class="flex flex-col px-2">
      
      <div>
        <h1 class="text-white text-5xl break-words lg:text-6xl lg:break-normal" itemprop="headline">Google Apps Script com OAuth2</h1>
      </div>
      <div>
        
        <p class="text-white text-2xl" itemprop="abstract">O Google Apps Script possui uma variedade de recursos que torna os aplicativos do Google ainda mais poderosos. Um destes recursos permite que aplicativos do Google possam se conectar a fontes externas. Ao longo deste post, este recurso será apresentado, com foco em APIs que utilizam o protocolo OAuth2 para autenticação.</p>
        
      </div>
      
    </div>
  </div>
</div>



  </header>
  <div class="bg-secondary hidden dark:bg-neutral lg:block">
    <div class="container container-box mx-auto">
      <div class="px-2">
      <nav aria-label="Breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
  <ul class="flex ml-auto mb-0">
    
  
    
  
    
  

  
  <li class="flex relative pr-7 last:pr-0 dark:filter dark:invert" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-gray-100" href="https://www.automacaodedados.com.br/" itemprop="item">
      
      <span class="text-white" itemprop="name">Home</span>
      
    </a>
    <i class="breadcrumb-separator"></i>
  </li>
  

  

  
  <li class="flex relative pr-7 last:pr-0 dark:filter dark:invert" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-gray-100" href="https://www.automacaodedados.com.br/stories/" itemprop="item">
      
        <span class="text-white" itemprop="name">Todas as histórias</span>
      
    </a>
    <i class="breadcrumb-separator"></i>
  </li>
  

  

  
  <li class="flex relative pr-7 last:pr-0 dark:filter dark:invert" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
    <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-gray-100" href="https://www.automacaodedados.com.br/stories/google-apps-script-com-oauth2/" aria-current="page" itemprop="item">
      <span class="text-white" itemprop="name">Google Apps Script com OAuth2</span>
    </a>
  </li>
  

  </ul>
</nav>



      </div>
    </div>
  </div>
  <div class="container container-box mx-auto">
    <div class="max-w-3xl px-2 mx-auto flex flex-col">
      <main id="post" itemprop="articleBody">
        <strong class="inline-block text-base mb-4 dark:text-white">Tempo estimado para a leitura: 18 minutos</strong>
        <p>Publicado em 29/01/2018 e atualizado em 07/11/2021.</p>
<p>Atualização 07/11/2021: Desde a publicação deste post, o Google Apps Script passou por uma série de modificações, incluíndo atualizações na interface, a adoção da especificação ES6 do Javascript, um novo sistema de logs de saída e um novo processo para gestão de gatilhos. O procedimento para autenticação em APIs que utilizam OAuth2, no entanto, permanece idêntico ao documentado neste post.</p>
<h2 id="o-que-é-oauth2">O que é OAuth2?</h2>
<p>Se trata da segunda versão de um protocolo de autorização em que recursos protegidos de algum tipo de sistema são acessados por usuários que possuam as devidas permissões. O protocolo OAuth foi apresentado no post sobre <a href="/stories/fundamentos-das-apis/" >fundamentos de APIs</a>.</p>
<h2 id="por-que-usar-oauth">Por que usar OAuth?</h2>
<p>Trabalhar com métodos como chaves de API requer quer a pessoa projetista de software utilize e armazene a chave de forma segura em sua aplicação. Embora alguns serviços tenham sistemas de permissão e restrição de uso das chaves, sua segurança ainda está sob a responsabilidade da pessoa desenvolvedora. Outro problema com chaves é que geralmente elas não levam em consideração o nível de privilégios que um usuário possui, o que torna difícil a distribuição correta das permissões. O protocolo OAuth trabalha com a ideia de tokens, chaves com data de expiração, permissões de acesso e pertencem a um usuário autenticado.</p>
<p>Para exemplificar a diferença entre o funcionamento de OAuth e uma chave de API, imagine o seguinte cenário: alguém chega em um hotel e pede um quarto. O gerente dá a essa pessoa um bolo de chaves que abre todas as portas, mesmo que ela vá usar apenas uma chave para entrar um quarto específico. Ao final da estadia, a pessoa vai embora e se esquece de devolver as chaves para o gerente. A experiência no hotel foi tão legal que ela indica o hotel para um conhecido, emprestando para ele o bolo de chaves com acesso a todos os quartos. No final do período, o segundo hóspede faz uma festa e estraga todo o quarto onde ficou. Neste exemplo, a chave de API é o bolo de chaves. Essas chaves não expiram, acessam todos os cômodos do hotel e qualquer um pode usar.</p>
<p>Imagine agora a reescrita deste cenário: a mesma pessoa vai em um outro hotel e solicita um quarto. O gerente pergunta para quantas pessoas e se possui preferências particulares. Após a pessoa responder, o gerente separa uma chave, entrega na mão do hóspede e informa o número do quarto. Ao final da estadia a pessoa devolve a chave para o gerente e deixa o hotel. A experiência foi muito agradável e essa pessoa recomenda um conhecido. A pessoa indicada vai conhecer o hotel e se depara com o gerente, que lhe pergunta que tipo de quarto ele gostaria. Ao descrever suas necessidades, o gerente lhe entrega uma outra chave, que abre a porta de outro quarto. Ao final da estadia, o indicado devolve a chave para o gerente e vai embora. Neste segundo exemplo, a chave é um token obtido por autenticação OAuth. Essa chave é usada por um usuário específico para acessar um recurso específico e está a disposição deste usuário enquanto ele for hóspede do hotel. Este é o conceito usado no fluxo de autorização do OAuth: a autenticação e concessão dos recursos protegidos é administrada tendo em vista a segurança. Mesmo que outro usuário tenha acesso a um token de autenticação, esse token não terá utilidade se não for associado a ele.</p>
<h2 id="o-fluxo-de-autorização-do-protocolo-oauth2">O fluxo de autorização do protocolo OAuth2</h2>
<p>Um fluxo OAuth2 funciona da seguinte maneira:</p>
<ul>
<li>Um usuário executa uma ação que dá início ao fluxo, como clicar em um botão;</li>
<li>A aplicação que armazena os dados protegidos pede as credenciais do usuário;</li>
<li>Se as credenciais estiverem corretas, o usuário é identificado. Caso contrário, o sistema rejeita a entrada do usuário;</li>
<li>O usuário autenticado recebe um token que o permite acessar os recursos designados pelo dono dos dados protegidos;</li>
<li>O usuário requisita dados protegidos e passa seu token de acesso;</li>
<li>Se o token e o usuário são reconhecidos, os dados são concedidos.</li>
</ul>
<p>Este fluxo se parece com o da imagem a seguir, criada pela <a href="https://www.digitalocean.com/" target="_blank" rel="noopener">Digital Ocean</a>:</p>
<figure >
  
  <img data-src="images/figure1-oauth2-authentication-process.webp" class="lazy" alt="Fluxo de autenticação OAuth2." title="Fluxo de autenticação OAuth2." />
  
  
  <figcaption>
    <p>Fluxo de autenticação OAuth2. Fonte: Digital Ocean.</p>
  </figcaption>
  
</figure>

<h2 id="como-oauth2-e-o-google-apps-scripts-são-usados-em-conjunto">Como OAuth2 e o Google Apps Scripts são usados em conjunto?</h2>
<p>Serviços externos usam diferentes formas para autenticar e autorizar usuários, e as vezes podem usar mais de uma. No caso dos apps do Google, por exemplo, eles costumam ter a disposição tanto chaves de API quanto OAuth2. O Google Apps Script não possui suporte nativo a OAuth2, porém possui bibliotecas externas que podem ser adicionadas aos projetos criados na ferramenta. Vejamos na prática como todo o processo funciona conectando uma planilha do Google Sheets com o <a href="https://search.google.com/search-console/about" target="_blank" rel="noopener">Google Search Console</a> (antigo Webmaster Tools).</p>
<h3 id="1-crie-um-novo-arquivo-no-google-sheets">1. Crie um novo arquivo no Google Sheets</h3>
<p>Crie um arquivo novo e vá em Tools &gt; Script Editor. O editor de scripts é o Google Apps Script.</p>
<figure >
  
  <img data-src="images/figure2-google-apps-script-editor.webp" class="lazy" alt="Editor de arquivos do Google Apps Script." title="Editor de arquivos do Google Apps Script." />
  
  
  <figcaption>
    <p>Editor de arquivos do Google Apps Script. Fonte: Autor.</p>
  </figcaption>
  
</figure>

<p>Com exceção do arquivo Code.gs, os demais arquivos foram criados por mim. A primeira coisa a ser feita é instalar a biblioteca que dá suporte a OAuth2. Com o editor aberto vá em Resources &gt; Libraries. O campo &ldquo;Find a Library&rdquo; busca bibliotecas disponíveis para extensão do script. O código da biblioteca OAuth2 usada neste post é <strong>1B7FSrk5Zi6L1rSxxTDgDEUsPzlukDsi4KGuTMorsTQHhGBzBkMun4iDF</strong>. Basta colar este código na caixa de busca e aparecerá a biblioteca. Selecione a versão mais recente (24 na época da escrita deste post) e selecione OK.</p>
<figure >
  
  <img data-src="images/figure3-google-apps-script-oauth2-plugin.webp" class="lazy" alt="Biblioteca OAuth2, feita pelo Google." title="Biblioteca OAuth2, feita pelo Google." />
  
  
  <figcaption>
    <p>Biblioteca OAuth2, feita pelo Google. Fonte: Autor.</p>
  </figcaption>
  
</figure>

<h3 id="2-configure-o-projeto-associado-ao-script-da-planilha-no-google-cloud-console">2. Configure o projeto associado ao script da planilha no Google Cloud Console</h3>
<p>O <a href="https://console.cloud.google.com/" target="_blank" rel="noopener">Google Cloud Console</a> é uma plataforma sobre a qual são construídos aplicativos usados pelos serviços do Google, como plugins. Nesta plataforma são gerenciados os aplicativos criados por pessoas desenvolvedoras e as credenciais de acesso que esses aplicativos possuem aos serviços do Google. Para acessar o Google Cloud Console vá em Resources &gt; Cloud Platform project. Abrirá um modal com um link cujo texto possui o formato [nome-do-script]-project-id-[id-do-projeto], onde [nome-do-script] é o nome dado ao script associado a planilha e [id-do-projeto] é um identificador único atribuído pelo Google Cloud Console.</p>
<figure >
  
  <img data-src="images/figure4-google-cloud-project-id.webp" class="lazy" alt="ID do Google Cloud Project associado ao script." title="ID do Google Cloud Project associado ao script." />
  
  
  <figcaption>
    <p>ID do Google Cloud Project associado ao script. Fonte: Autor.</p>
  </figcaption>
  
</figure>

<p>Todo projeto criado no Google Apps Script cria também um projeto no Google Cloud Console, onde é feita a gestão das credenciais utilizadas para acessar serviços externos.</p>
<figure >
  
  <img data-src="images/figure5-google-cloud-project-info.webp" class="lazy" alt="Painel de informações do projeto criado no Google Cloud Console." title="Painel de informações do projeto criado no Google Cloud Console." />
  
  
  <figcaption>
    <p>Painel de informações do projeto criado no Google Cloud Console. Fonte: Autor.</p>
  </figcaption>
  
</figure>

<p>Uma vez que o projeto esteja aberto, é necessário selecionar os serviços do Google que serão usados. Há um para o Search Console, que será usado neste post. Dentro da caixa &ldquo;Getting Started&rdquo; clique em &ldquo;Enable APIs and get credentials like keys&rdquo;. No menu lateral, vá para &ldquo;Library&rdquo; e na caixa de busca digite &ldquo;Search Console&rdquo;. O primeiro resultado é o da API chamada &ldquo;Google Search Console API&rdquo;. Clique nele e clique no botão &ldquo;Enable&rdquo;.</p>
<figure >
  
  <img data-src="images/figure6-google-search-console-api.webp" class="lazy" alt="Serviço de conexão com a API do Google Search Console." title="Serviço de conexão com a API do Google Search Console." />
  
  
  <figcaption>
    <p>Serviço de conexão com a API do Google Search Console. Fonte: Autor.</p>
  </figcaption>
  
</figure>

<p>Selecionada a API, é necessário informar como será feito o processo de autorização aos dados que a API entregará. Existem basicamente dois tipos: chave de autenticação e OAuth2. Neste post será usada a opção OAuth2. No menu lateral, acesse a opção &ldquo;Credentials&rdquo; e na tela exibida, clique no botão &ldquo;Create credentials&rdquo;. No drop down que surge, clique em &ldquo;OAuth client ID&rdquo;.</p>
<figure >
  
  <img data-src="images/figure7-google-cloud-project-credentials.webp" class="lazy" alt="Passo 1 da configuração de novas credenciais para acesso a API do Google Search Console." title="Passo 1 da configuração de novas credenciais para acesso a API do Google Search Console." />
  
  
  <figcaption>
    <p>Passo 1 da configuração de novas credenciais para acesso a API do Google Search Console. Fonte: Autor.</p>
  </figcaption>
  
</figure>

<p>O Google Cloud Console pergunta que tipo de aplicativo a pessoa desenvolvedora está criando. Para trabalhar com o Google Apps Script é necessário selecionar a opção &ldquo;Web application&rdquo; e preencher as informações que surgem na porção inferior da tela. As duas informações necessárias para preenchimento são o nome do aplicativo e pelo menos uma URL de redirecionamento, que será usada para redirecionar o usuário após a autenticação. A URL de redirecionamento será o próprio script do Google Apps Script. A URL de um script possui o formato <a href="https://script.google.com/macros/d/%5BSCRIPT">https://script.google.com/macros/d/[SCRIPT</a> ID]/usercallback, onde [SCRIPT ID] é o identificador do script gerado pelo Google Apps Script quando o projeto foi criado. Esse id pode ser acessado em File &gt; Project properties. Copie o id e monte o restante da URL.</p>
<p>Configurado o projeto e a forma de autorização, duas informações serão disponibilizadas no painel do Google Cloud Console: um CLIENT ID e um CLIENT SECRET. Essas informações serão usadas para construir uma segunda URL, a URL de autenticação. Copie estas credenciais e feche o Google Cloud Console.</p>
<h3 id="3-escreva-os-códigos-de-autorização-e-chamadas-a-api">3. Escreva os códigos de autorização e chamadas a API</h3>
<p>Agora que o Google Cloud Console está pronto para gerenciar requisições de um aplicativo externo é possível fazer chamadas a este serviço pelo Google Apps Script, contanto que existam credenciais com permissões de acesso aos recursos do Search Console. A primeira coisa a ser feita é escrever o código que será usado para autorizar usuários que queriam acessar o Search Console a partir da planilha. O editor de scripts criou um arquivo chamado Code.gs e uma função vazia. Criei um arquivo novo contendo as variáveis globais do código para facilitar a manutenção. No arquivo criado, declare as seguintes variáveis:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">CLIENT_ID</span> <span class="o">=</span> <span class="s1">&#39;SEU_CLIENT_ID&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">CLIENT_SECRET</span> <span class="o">=</span> <span class="s1">&#39;SEU_CLIENT_SECRET&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">SCOPE</span> <span class="o">=</span> <span class="s1">&#39;https://www.googleapis.com/auth/webmasters.readonly&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">SITE</span> <span class="o">=</span> <span class="s1">&#39;SEU_SITE_NO_SEARCH_CONSOLE&#39;</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<p>CLIENT_ID e CLIENT_SECRET são as credenciais fornecidas pelo Google Cloud Console na criação no método de autorização. Coloque-as nos locais indicados por &ldquo;SEU_CLIENT_ID&rdquo; E &ldquo;SEU_CLIENT_SECRET&rdquo;. O escopo de acesso é necessário para qualquer fluxo OAuth2 e representa o conjunto de permissões a que um usuário tem acesso. Todos os escopos de produtos do Google para uso em autorizações OAuth2 estão disponíveis na <a href="https://developers.google.com/identity/protocols/googlescopes" target="_blank" rel="noopener">documentação do Google</a>. O Search Console possui dois escopos: <em>readonly</em>, para apenas leitura e <em>webmasters</em>, para leitura e modificação das informações. Neste post será usado o escopo <em>readonly</em>. A variável SITE contém o site cadastrado no Search Console cujos dados iremos consultar. O nome do site deve ser informado da forma como está no search console. Se o site é, por exemplo, <a href="http://henriquefreitas.com.br">http://henriquefreitas.com.br</a>, a variável deve ser preenchida de acordo.</p>
<p>Crie um novo arquivo em File &gt; New &gt; Script file. Dê um nome para o arquivo e clique em OK. Neste arquivo será colocado o código que cria o objeto que dá início ao fluxo de autorização OAuth2:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">getService</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">OAuth2</span><span class="p">.</span><span class="nx">createService</span><span class="p">(</span><span class="s1">&#39;searchconsole&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">setAuthorizationBaseUrl</span><span class="p">(</span><span class="s1">&#39;https://accounts.google.com/o/oauth2/auth&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">setTokenUrl</span><span class="p">(</span><span class="s1">&#39;https://accounts.google.com/o/oauth2/token&#39;</span><span class="p">)</span>

      <span class="p">.</span><span class="nx">setClientId</span><span class="p">(</span><span class="nx">CLIENT_ID</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">setClientSecret</span><span class="p">(</span><span class="nx">CLIENT_SECRET</span><span class="p">)</span>

      <span class="p">.</span><span class="nx">setCallbackFunction</span><span class="p">(</span><span class="s1">&#39;authCallback&#39;</span><span class="p">)</span>

      <span class="p">.</span><span class="nx">setPropertyStore</span><span class="p">(</span><span class="nx">PropertiesService</span><span class="p">.</span><span class="nx">getUserProperties</span><span class="p">())</span>

      <span class="p">.</span><span class="nx">setScope</span><span class="p">(</span><span class="nx">SCOPE</span><span class="p">)</span>

      <span class="p">.</span><span class="nx">setParam</span><span class="p">(</span><span class="s1">&#39;login_hint&#39;</span><span class="p">,</span> <span class="nx">Session</span><span class="p">.</span><span class="nx">getActiveUser</span><span class="p">().</span><span class="nx">getEmail</span><span class="p">())</span>
      <span class="p">.</span><span class="nx">setParam</span><span class="p">(</span><span class="s1">&#39;access_type&#39;</span><span class="p">,</span> <span class="s1">&#39;offline&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">authCallback</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="nx">getService</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">isAuthorized</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">handleCallback</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isAuthorized</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createHtmlOutput</span><span class="p">(</span><span class="s1">&#39;Autorizado. Pode fechar esta aba.&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createHtmlOutput</span><span class="p">(</span><span class="s1">&#39;Acesso negado. Verifique as credenciais fornecidas e tente novamente. Pode fechar esta aba.&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>Repare que as variáveis criadas no arquivo de variáveis globais são reconhecidas neste novo arquivo. A função getService é a responsável por criar e retornar um objeto OAuth2 com escopo e fluxo de autenticação definidos. Vários métodos são encadeados para obter o resultado final:</p>
<ul>
<li>setAuthorizationBaseUrl monta a URL base de autenticação. Essa URL é composta por informações como o CLIENT ID e o CLIENT SECRET portanto ela muda para cada usuário. A porção base, no entanto, é especificada neste método;</li>
<li>setTokenUrl é a URL que retorna tokens de autenticação para usuários autorizados;</li>
<li>setCallbackFunction aponta uma função que será executada após a tentativa de autenticação;</li>
<li>setPropertyStore determina o local onde tokens autorizados são armazenados;</li>
<li>setScope determina o escopo de acesso aos dados protegidos;</li>
<li>setParam adiciona configurações personalizadas. O parâmetro login_hint previne que a tela de login seja mostrada várias vezes para usuários logados em mais de uma conta do Google. O parâmetro access_type autoriza o uso das informações offline.</li>
</ul>
<p>A função authCallback é executada sempre que getService é chamada. Ela verifica se a autorização foi concedida e informa ao usuários solicitante. No exemplo, uma aba é aberta no navegador com um texto informando o status da tentativa de autenticação.</p>
<p>Crie mais um arquivo em File &gt; New &gt; Script file. Dê um nome para o arquivo e clique em OK. Neste arquivo serão feitas as chamadas ao serviço e solicitados os dados do Search Console mediante autenticação. Escreva o seguinte código:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">getSearchConsole</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">apiUrl</span> <span class="o">=</span> <span class="s1">&#39;https://www.googleapis.com/webmasters/v3/sites/&#39;</span> <span class="o">+</span> <span class="nx">SITE</span> <span class="o">+</span> <span class="s1">&#39;/searchAnalytics/query?fields=rows&amp;alt=json&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">getSearchConsoleData</span><span class="p">(</span><span class="nx">apiUrl</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">json</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">reportHeaders</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;Keyword&#39;</span><span class="p">,</span> <span class="s1">&#39;Clicks&#39;</span><span class="p">,</span> <span class="s1">&#39;Impressions&#39;</span><span class="p">,</span> <span class="s1">&#39;CTR&#39;</span><span class="p">,</span> <span class="s1">&#39;Position&#39;</span><span class="p">]];</span>
      <span class="nx">displaySearchConsoleData</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">reportHeaders</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getSearchConsoleData</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">dimensions</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">headers</span><span class="p">,</span> <span class="nx">payload</span><span class="p">,</span> <span class="nx">options</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">startDate</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">-</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span> <span class="nx">Session</span><span class="p">.</span><span class="nx">getScriptTimeZone</span><span class="p">(),</span> <span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">endDate</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span> <span class="nx">Session</span><span class="p">.</span><span class="nx">getScriptTimeZone</span><span class="p">(),</span> <span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="nx">getService</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">hasAccess</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span> <span class="s1">&#39;Bearer &#39;</span> <span class="o">+</span> <span class="nx">service</span><span class="p">.</span><span class="nx">getAccessToken</span><span class="p">()</span> <span class="p">};</span>
    <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;startDate&#39;</span><span class="o">:</span> <span class="nx">startDate</span><span class="p">,</span>
      <span class="s1">&#39;endDate&#39;</span><span class="o">:</span> <span class="nx">endDate</span><span class="p">,</span>
      <span class="s1">&#39;dimensions&#39;</span><span class="o">:</span> <span class="nx">dimensions</span>
    <span class="p">};</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;headers&#39;</span><span class="o">:</span> <span class="nx">headers</span><span class="p">,</span>
      <span class="s1">&#39;contentType&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
      <span class="s1">&#39;method&#39;</span><span class="o">:</span> <span class="s1">&#39;post&#39;</span><span class="p">,</span>
      <span class="s1">&#39;payload&#39;</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">payload</span><span class="p">),</span>
      <span class="s1">&#39;muteHttpExceptions&#39;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">};</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">response</span> <span class="o">=</span> <span class="nx">UrlFetchApp</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="nx">showDialog</span><span class="p">();</span>

  <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">displaySearchConsoleData</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">reportHeaders</span><span class="p">,</span> <span class="nx">numKeys</span><span class="p">,</span> <span class="nx">initialColumnPosition</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">searchConsoleData</span> <span class="o">=</span> <span class="nx">spreadsheet</span><span class="p">.</span><span class="nx">getActiveSpreadsheet</span><span class="p">().</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="s1">&#39;Search Console&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">report</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">json</span><span class="p">.</span><span class="nx">rows</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">numKeys</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">keys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
        <span class="nx">json</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">keys</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
      <span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">report</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">keys</span><span class="p">);</span>

    <span class="nx">report</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">clicks</span><span class="p">,</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">impressions</span><span class="p">,</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">ctr</span><span class="p">,</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">position</span>
    <span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">searchConsoleData</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">initialColumnPosition</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">reportHeaders</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">).</span><span class="nx">setValues</span><span class="p">(</span><span class="nx">reportHeaders</span><span class="p">);</span>
  <span class="nx">searchConsoleData</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">initialColumnPosition</span><span class="p">,</span> <span class="nx">report</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">reportHeaders</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">).</span><span class="nx">setValues</span><span class="p">(</span><span class="nx">report</span><span class="p">);</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>Foram criadas funções diferentes para modularizar o projeto. É possível fazer diferentes chamadas a API especificando diferentes visões de dados para serem retornadas. O que este código faz:</p>
<ul>
<li>A função getSearchConsole monta o <em>endpoint</em> da API que contém os dados de interesse;</li>
<li>Na sequência, faz uma chamada a essa URL usando a função getSearchConsoleData que foi criada passando como parâmetros a URL e uma lista com apenas um item: query. Query é o parâmetro que retorna as palavras chave que resultaram em impressões ou cliques de resultados do site na SERP (página de resultados de busca). Outros possíveis parâmetros de retorno são page, device, country, search type e date. Para passar mais de um parâmetro na lista, basta incluir novos itens no array, por exemplo: [&lsquo;query&rsquo;, &lsquo;page&rsquo;, &lsquo;device&rsquo;]. Essa lista de parâmetros representa as dimensões pelas quais as métricas serão organizadas;</li>
<li>Verifica se a chamada a API retornou dados do Google Search Console;</li>
<li>Se há dados, decodifica a string de retorno, que está em formato JSON, e escreve os dados na planilha usando o método displaySearchConsoleData, criada no fim do arquivo. Os parâmetros recebidos em displaySearchConsoleData são o retorno da chamada a API decodificado, o cabeçalho do relatório em um array multidimensional, um número de chaves que representa seções específicas do arquivo de retorno a chamada da API e o número da coluna mais à esquerda onde os dados serão escritos na planilha.</li>
</ul>
<p>Uma chamada a API do Google Search Console vai devolver um objeto como o do exemplo a seguir:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="p">{</span>
    <span class="nx">keys</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;palavra_chave&#39;</span>
    <span class="p">},</span>
    <span class="nx">clicks</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="nx">impressions</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="nx">ctr</span><span class="o">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="nx">position</span><span class="o">:</span> <span class="mf">3.2</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">keys</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;outra_palavra&#39;</span>
    <span class="p">},</span>
    <span class="nx">clicks</span><span class="o">:</span> <span class="mi">2000</span><span class="p">,</span>
    <span class="nx">impressions</span><span class="o">:</span> <span class="mi">3000</span><span class="p">,</span>
    <span class="nx">ctr</span><span class="o">:</span> <span class="mf">0.6</span><span class="p">,</span>
    <span class="nx">position</span><span class="o">:</span> <span class="mf">1.2</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>A seção keys contém as dimensões (ou qualidades) dos dados, e as métricas estão nas demais propriedades do objeto. O parâmetro que informa o número de chaves basicamente informa quantas dimensões o arquivo de retorno tem para que a função de imprimir os dados na tela monte a tabela corretamente. O último parâmetro informa a partir de qual coluna o relatório deve ser gerado.</p>
<p>A função getSearchConsoleData, chamada por getSearchConsole, faz o seguinte:</p>
<ul>
<li>Consulta o objeto OAuth2 pela função getService e verifica se o usuário está autorizado a puxar os dados do Search Console;</li>
<li>Caso esteja autorizado, são criados objetos de configuração dos cabeçalhos da requisição e os dados de configuração da solicitação (data de início, data de fim e dimensões);</li>
<li>Chama a API usando um método estático do Google Apps Script: UrlFetchApp.fetch(url, options). Esse método retorna um objeto HTTPResponse contendo os dados e cabeçalhos de resposta;</li>
<li>O resultado da chamada será devolvido na variável response, que é retornada pela função;</li>
<li>O método showDialog, acionado caso o usuário não esteja logado, será criado posteriormente.</li>
</ul>
<p>A função displaySearchConsoleData mostra na planilha os dados retornados da API e recebe como parâmetros o objeto contendo os dados de retorno já decodificados, uma lista de cabeçalhos em um array multidimensional e os já comentados número de chaves e o número da coluna a partir do qual o relatório será mostrado. Ela funciona da seguinte maneira:</p>
<ul>
<li>Abre uma pasta na planilha chamada Search Console (veja se o nome da pasta onde os dados do Google Search Console serão colocados é igual ao nome da pasta nesta linha);</li>
<li>Itera pelo objeto retornado, acessando suas propriedades;</li>
<li>Armazena as dimensões selecionadas em um array chamado keys;</li>
<li>Armazena o array keys dentro de outro chamado report;</li>
<li>Itera pelas propriedades com as métricas do Search Console, adicionando-as também na lista report;</li>
<li>Escreve na planilha os cabeçalhos da tabela e os dados de retorno.</li>
</ul>
<h3 id="4-construa-uma-interface-que-permita-chamadas-à-api">4. Construa uma interface que permita chamadas à API</h3>
<p>Até o momento não há como interagir com esse script a partir da planilha. No editor de códigos do Google Apps Script, crie um arquivo novo e escreva o seguinte código:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">showSidebar</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="nx">getService</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">template</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">service</span><span class="p">.</span><span class="nx">hasAccess</span><span class="p">())</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">authorizationUrl</span> <span class="o">=</span> <span class="nx">service</span><span class="p">.</span><span class="nx">getAuthorizationUrl</span><span class="p">();</span>
    <span class="nx">template</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createTemplate</span><span class="p">(</span>
      <span class="s1">&#39;&lt;h1&gt;Autentication&lt;/h1&gt; &#39;</span> <span class="o">+</span>
      <span class="s1">&#39;&lt;a href=&#34;&lt;?= authorizationUrl ?&gt;&#34; target=&#34;_blank&#34;&gt;Autorize este script a acessar a API do Google Search Console em seu nome.&lt;/a&gt;. &#39;</span> <span class="o">+</span>
      <span class="s1">&#39;&lt;p&gt;Por que preciso fazer isso?&lt;/p&gt; &#39;</span> <span class="o">+</span>
      <span class="s1">&#39;&lt;p&gt;Este aplicativo precisa da sua permissão para fazer a leitura dos dados da sua conta no Google Search Console.&lt;/p&gt;&#39;</span>
    <span class="p">);</span>
    <span class="nx">template</span><span class="p">.</span><span class="nx">authorizationUrl</span> <span class="o">=</span> <span class="nx">authorizationUrl</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">template</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createTemplate</span><span class="p">(</span><span class="s1">&#39;O script já possui autorização para acessar os dados do Search Console. Esta aba pode ser fechada.&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">page</span> <span class="o">=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">();</span>
  <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getUi</span><span class="p">().</span><span class="nx">showSidebar</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">showDialog</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">service</span> <span class="o">=</span> <span class="nx">getService</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">service</span><span class="p">.</span><span class="nx">hasAccess</span><span class="p">())</span> <span class="nx">Browser</span><span class="p">.</span><span class="nx">msgBox</span><span class="p">(</span><span class="s1">&#39;Autorize este script a acessar os dados do Search Console por você. Acesse Search Console &gt; Login.&#39;</span><span class="p">,</span> <span class="nx">Browser</span><span class="p">.</span><span class="nx">Buttons</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getData</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">getSearchConsole</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Browser</span><span class="p">.</span><span class="nx">msgBox</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">Browser</span><span class="p">.</span><span class="nx">Buttons</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">onOpen</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">ui</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getUi</span><span class="p">();</span>
  <span class="nx">ui</span><span class="p">.</span><span class="nx">createMenu</span><span class="p">(</span><span class="s1">&#39;Search Console&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">addItem</span><span class="p">(</span><span class="s1">&#39;Login&#39;</span><span class="p">,</span> <span class="s1">&#39;showSidebar&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">addItem</span><span class="p">(</span><span class="s1">&#39;Refresh data&#39;</span><span class="p">,</span> <span class="s1">&#39;getData&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">addToUi</span><span class="p">();</span>

  <span class="nx">showDialog</span><span class="p">();</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>A função showSidebar monta uma barra lateral na planilha com um link para iniciar o fluxo OAuth2. Se o usuário já estiver autenticado, esta informação será apresentada a ela na barra lateral.</p>
<p>A função showDialog apresenta uma mensagem pedindo que o usuário navegue até o menu Search Console &gt; Login. A função que gera este menu será criada adiante, neste mesmo arquivo.</p>
<p>A função getData faz uma chamada a API do Search Console. Se a chamada não dá certo, apresenta uma mensagem de erro para o usuário.</p>
<p>A função onOpen é uma função especial do Google Apps Script que executa sempre que o arquivo associado ao script, neste caso a planilha, é aberta. Sempre que o arquivo for aberto, esta função criará um menu chamado Search Console com duas opções: Login, para iniciar o fluxo de autenticação e apontando para a função showSidebar, e um menu chamado Refresh data, que faz uma chamada a API.</p>
<h3 id="5-automatize-a-chamada-a-api-opcional">5. Automatize a chamada a API (opcional)</h3>
<p>Da forma como está, os dados dos últimos sete dias do Search Console serão escritos na planilha especificada, mas é possível automatizar essa chamada para que os usuários não precisem abrir o menu para atualizar os dados. Para isso, vá no editor de scripts e acesse o menu Edit &gt; Current project&rsquo;s triggers. Essa opção também está disponível na barra de ferramentas, representada por um ícone de um relógio. Ao clicar no relógio ou usar o menu, aparecerá um modal para criação de triggers. Experimente criar um novo trigger que chame a função getData a cada hora, por exemplo. Clique em Save. De hora em hora esta função será chamada e os dados da planilha serão atualizados automaticamente!</p>
<figure >
  
  <img data-src="images/figure8-google-apps-script-run-trigger.webp" class="lazy" alt="Configuração de gatilho para disparo automático da função de atualização dos dados do Search Console." title="Configuração de gatilho para disparo automático da função de atualização dos dados do Search Console." />
  
  
  <figcaption>
    <p>Configuração de gatilho para disparo automático da função de atualização dos dados do Search Console. Fonte: Autor.</p>
  </figcaption>
  
</figure>

<h2 id="automação-com-google-apps-script">Automação com Google Apps Script</h2>
<p>Scripts como o deste post são extremamente úteis para automatizar tarefas repetidas e realocar pessoas em tarefas mais estratégicas para o departamento onde trabalham ou mesmo para a empresa como um todo. Automação e extensão de funcionalidades de produtos Google são apenas algumas das coisas que o Google Apps Script pode fazer. A implementação apresentada neste post pode ser aplicada para gerar backups dos volumes e termos de busca para a propriedade configurada. O Search Console armazena dados dos últimos doze meses, sendo necessário criar backups periódicos para consultar períodos mais antigos. Basta fazer um pequeno ajuste neste script para que novas linhas não sobrescrevam as antigas na planilha e pronto! Backups automáticos configurados.</p>
<h2 id="leitura-complementar">Leitura complementar</h2>
<p>Leia os seguintes conteúdos para se aprofundar mais em Google Apps Script e no protocolo OAuth2:</p>
<ul>
<li><a href="https://github.com/googlesamples/apps-script-oauth2" target="_blank" rel="noopener">Biblioteca OAuth2</a> disponibilizada pelo próprio Google e usada neste post;</li>
<li><a href="https://developers.google.com/apps-script/overview" target="_blank" rel="noopener">Documentação do Google Apps Script</a>;</li>
<li>O post sobre <a href="/stories/fundamentos-das-apis/" >fundamentos de APIs</a> escrito neste blog;</li>
<li>O post sobre <a href="/stories/uma-introducao-ao-google-apps-script/" >fundamentos do Google Apps Script</a> escrito neste blog;</li>
<li><a href="https://aaronparecki.com/oauth-2-simplified/" target="_blank" rel="noopener">Os fundamentos de OAuth, por Aaron Parecki</a>;</li>
<li><a href="https://developers.google.com/identity/protocols/OAuth2" target="_blank" rel="noopener">OAuth2 com Google Apps</a>;</li>
<li><a href="https://developers.google.com/oauthplayground/" target="_blank" rel="noopener">Playground de experimentação com OAuth2 para os serviços do Google</a>;</li>
<li><a href="https://developers.google.com/apis-explorer/#p/" target="_blank" rel="noopener">Lista de endpoints e testes de chamadas as APIs do Google</a>.</li>
</ul>
<p>Bora automatizar!</p>

      </main>
      <footer>
        


<div class="h-1 w-16 my-6 bg-gray-900 mx-auto dark:bg-white"></div>
<div class="flex justify-center items-center" itemprop="author" itemscope itemtype="https://schema.org/Person">
  <div class="mr-4 w-3/12 md:w-2/12">
    <img class="rounded-full" src="/images/profiles/henriquesouza/profile.webp" alt="Henrique Freitas Souza" itemprop="image">
  </div>
  <div class="w-9/12 md:w-10/12">
    <address class="font-title dark:text-white" itemprop="name">Henrique Freitas Souza</address>
    
    <p class="mb-auto text-base dark:text-white" itemprop="description">Certa vez li que dados são como resíduos nucleares. Desde então tomo cuidado redobrado com o uso que faço deles.</p>
    
  </div>
</div>


      </footer>
    </div>
  </div>
</article>

  
  
<div class="container container-box mx-auto">
  <div class="px-2 lg:px-0">
    <aside role="complementary">
      <span class="inline-block w-full font-title text-3xl text-center mb-4 px-2 dark:text-white">Leia também estas histórias</span>
      <div class="lg:flex lg:flex-wrap lg:justify-start">
        
          




<div class="mb-4 lg:mb-0 lg:p-2 lg:w-1/2 xl:w-1/3">
  <article class="relative flex flex-col bg-gray-300 p-6 h-full rounded-lg dark:bg-secondary-darker" role="article" itemscope itemtype="https://schema.org/Article">
  
    
    <div class="absolute inset-0 bg-cover bg-center filter brightness-50 rounded-lg" style="background-image: url('https://www.automacaodedados.com.br/stories/configurando-metabase-e-postgresql-no-docker/images/thumbnail_hu46ba3eab324bd3b57676d5fcac380c13_42865_500x500_fill_q75_box_smart1.jpg');"></div>
  
    <header class="relative flex flex-wrap justify-between items-center mb-6">
      
      <div>
        <address class="text-white text-base" itemprop="author">Henrique</address>
        <time class="text-white text-base" itemprop="datePublished" pubdate datetime="2020-11-17 09:10:00 &#43;0000 UTC">17/11/2020 09:10:00</time>
      </div>
      <a href="https://www.automacaodedados.com.br/categories/automa%C3%A7%C3%A3o" class="badge" itemprop="articleSection">automação</a>
      
    </header>
    <main class="relative" itemprop="articleBody">
      
      <h2 class="text-white" itemprop="headline">Configurando Metabase e PostgreSQL no Docker</h2>
      <p class="mb-6 text-white" itemprop="abstract">Como elaborar uma arquitetura de serviços simples, de fácil manutenção e portátil utilizando o Docker? Ao longo deste post, você vai descobrir como fazer isso integrando um banco de dados PostgreSQL …</p>
      <div>
        <a class="button-primary" href="https://www.automacaodedados.com.br/stories/configurando-metabase-e-postgresql-no-docker/">Leia mais</a>
      </div>
      
    </main>
  </article>
</div>

        
          




<div class="mb-4 lg:mb-0 lg:p-2 lg:w-1/2 xl:w-1/3">
  <article class="relative flex flex-col bg-gray-300 p-6 h-full rounded-lg dark:bg-secondary-darker" role="article" itemscope itemtype="https://schema.org/Article">
  
    
    <div class="absolute inset-0 bg-cover bg-center filter brightness-50 rounded-lg" style="background-image: url('https://www.automacaodedados.com.br/stories/rd-station-e-google-sheets-na-aws/images/thumbnail_hu4a2eaaaa0922d32f9b411fc58706e27f_32210_500x500_fill_q75_box_smart1.jpg');"></div>
  
    <header class="relative flex flex-wrap justify-between items-center mb-6">
      
      <div>
        <address class="text-white text-base" itemprop="author">Henrique</address>
        <time class="text-white text-base" itemprop="datePublished" pubdate datetime="2020-09-03 19:23:00 &#43;0000 UTC">03/09/2020 19:23:00</time>
      </div>
      <a href="https://www.automacaodedados.com.br/categories/automa%C3%A7%C3%A3o" class="badge" itemprop="articleSection">automação</a>
      
    </header>
    <main class="relative" itemprop="articleBody">
      
      <h2 class="text-white" itemprop="headline">RD Station e Google Sheets Parte 2 - Migrando para a AWS</h2>
      <p class="mb-6 text-white" itemprop="abstract">Já vimos neste blog como fazer para enviar leads do RD Station para uma planilha automaticamente. Agora vamos ver como enviar estes mesmos leads para um banco de dados hospedado na AWS</p>
      <div>
        <a class="button-primary" href="https://www.automacaodedados.com.br/stories/rd-station-e-google-sheets-na-aws/">Leia mais</a>
      </div>
      
    </main>
  </article>
</div>

        
          




<div class="mb-4 lg:mb-0 lg:p-2 lg:w-1/2 xl:w-1/3">
  <article class="relative flex flex-col bg-gray-300 p-6 h-full rounded-lg dark:bg-secondary-darker" role="article" itemscope itemtype="https://schema.org/Article">
  
    
    <div class="absolute inset-0 bg-cover bg-center filter brightness-50 rounded-lg" style="background-image: url('https://www.automacaodedados.com.br/stories/rd-station-e-google-sheets/images/thumbnail_hu9a8e1eb5a7452283d6f6255f788ec07e_26449_500x500_fill_q75_box_smart1.jpg');"></div>
  
    <header class="relative flex flex-wrap justify-between items-center mb-6">
      
      <div>
        <address class="text-white text-base" itemprop="author">Henrique</address>
        <time class="text-white text-base" itemprop="datePublished" pubdate datetime="2018-09-02 14:07:00 &#43;0000 UTC">02/09/2018 14:07:00</time>
      </div>
      <a href="https://www.automacaodedados.com.br/categories/automa%C3%A7%C3%A3o" class="badge" itemprop="articleSection">automação</a>
      
    </header>
    <main class="relative" itemprop="articleBody">
      
      <h2 class="text-white" itemprop="headline">RD Station e Google Sheets: exportação automática de leads para planilhas</h2>
      <p class="mb-6 text-white" itemprop="abstract">Saiba como enviar dados de leads automaticamente para planilhas no Google Sheets a partir do software de automação de marketing RD Station.</p>
      <div>
        <a class="button-primary" href="https://www.automacaodedados.com.br/stories/rd-station-e-google-sheets/">Leia mais</a>
      </div>
      
    </main>
  </article>
</div>

        
      </div>
    </aside>
  </div>
</div>
  


      </main>
      <footer>
        <div class="bg-secondary-darker">
  <div class="container container-box mx-auto">
    <div class="flex flex-wrap justify-between px-2 lg:px-0">
      <div class="w-full mb-6 last:mb-auto lg:mb-auto lg:p-2 lg:w-2/4">
        <div class="flex items-center mb-4">
          <img src="https://www.automacaodedados.com.br/images/automacaodedados_logo_white.svg" alt="Logo Automação de Dados" class="mr-2 w-16 h-8">
          <span class="font-title inline-block text-white text-base">Automação de Dados</span>
        </div>
        <p class="text-white">Espaço para a divulgação de informações que ajudem a democratizar o conhecimento sobre novas tecnologias no Brasil.</p>
      </div>
      <div class="w-full mb-6 last:mb-auto lg:mb-auto lg:p-2 lg:w-1/4">
  <span class="font-title inline-block mb-4 text-white text-base">Todas as categorias</span>
  <nav role="navigation" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul class="list-none ml-auto">
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/categories/analytics/" itemprop="item">
          <span class="text-white" itemprop="name">Analytics</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/categories/an%C3%A1lise/" itemprop="item">
          <span class="text-white" itemprop="name">Análise</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/categories/automa%C3%A7%C3%A3o/" itemprop="item">
          <span class="text-white" itemprop="name">Automação</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/categories/design/" itemprop="item">
          <span class="text-white" itemprop="name">Design</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/categories/empreendedorismo/" itemprop="item">
          <span class="text-white" itemprop="name">Empreendedorismo</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/categories/estat%C3%ADstica/" itemprop="item">
          <span class="text-white" itemprop="name">Estatística</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/categories/governan%C3%A7a/" itemprop="item">
          <span class="text-white" itemprop="name">Governança</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/categories/marketing/" itemprop="item">
          <span class="text-white" itemprop="name">Marketing</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/categories/programa%C3%A7%C3%A3o/" itemprop="item">
          <span class="text-white" itemprop="name">Programação</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/categories/visualiza%C3%A7%C3%A3o/" itemprop="item">
          <span class="text-white" itemprop="name">Visualização</span>
        </a>
      </li>
      
    </ul>
  </nav>
</div>
<div class="w-full mb-6 last:mb-auto lg:mb-auto lg:p-2 lg:w-1/4">
  <span class="font-title inline-block mb-4 text-white text-base">Últimas histórias</span>
  <nav role="navigation" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <ul class="list-none ml-auto">
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/stories/construcao-da-identidade-no-espaco-virtual/" itemprop="item">
          <span class="text-white" itemprop="name">Construção da identidade no espaço virtual</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/stories/como-escolher-o-melhor-grafico/" itemprop="item">
          <span class="text-white" itemprop="name">Como escolher o melhor gráfico?</span>
        </a>
      </li>
      
      <li class="mb-2 last:mb-auto" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a class="text-white no-underline hover:text-white hover:underline dark:hover:text-white" href="https://www.automacaodedados.com.br/stories/configurando-metabase-e-postgresql-no-docker/" itemprop="item">
          <span class="text-white" itemprop="name">Configurando Metabase e PostgreSQL no Docker</span>
        </a>
      </li>
      
    </ul>
  </nav>
</div>

    </div>
  </div>
</div>
<div class="bg-gray-300">
  <div class="container container-box mx-auto">
    <div class="text-center lg:flex lg:justify-between lg:items-center lg:text-left px-2">
      <span class="inline-block text-base dark:text-gray-900">Feito com Hugo &#43; Tailwind e hospedado no Github Pages.</span>
      <div itemscope itemtype="https://schema.org/Language">
        <ul class="ml-auto mb-0">
          
          <li class="inline-block" itemprop="availableLanguage" itemscope itemtype="https://schema.org/Language">
            <a class="px-2 py-1 text-base no-underline hover:text-gray-900 hover:underline dark:text-gray-900 dark:hover:text-gray-900" href="https://www.automacaodedados.com.br/" itemprop="name">🇧🇷 Português</a>
          </li>
          
          <li class="inline-block" itemprop="availableLanguage" itemscope itemtype="https://schema.org/Language">
            <a class="px-2 py-1 text-base no-underline hover:text-gray-900 hover:underline dark:text-gray-900 dark:hover:text-gray-900" href="https://www.automacaodedados.com.br/en/" itemprop="name">🇺🇸 English</a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
</div>

      </footer>
    </div>
    <script src="/js/theme.min.js"></script>

    
<script src="/js/lazy.min.js" async></script>

  </body>
</html>
