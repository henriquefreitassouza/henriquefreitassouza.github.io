let T=t=>fetch("/i18n/search.json").then(e=>e.json()).then(e=>e[t]),loadIndex=(e,t)=>fetch("/search-index."+e+".json").then(e=>e.json()).then(e=>({results:lunr.Index.load(e.index).search(t),corpus:e.corpus})).catch(e=>null),render=(r,e,n,a="create")=>fetch("/js/templates/"+e+".html").then(e=>e.text()).then(e=>{let t=Handlebars.compile(e);return"update"==a?r.insertAdjacentHTML("beforeend",t(n)):r.innerHTML=t(n),r}),paginate=(e,t,r)=>e.slice((r-1)*t,t*r);const lang=document.documentElement.getAttribute("lang"),translate=T(lang);let translated={};translate.then(r=>{Object.keys(r).forEach(function(e,t){translated[e]=r[e]})}),window.addEventListener("load",()=>{const e=new URLSearchParams(window.location.search),t=document.getElementsByTagName("h1")[0],p=document.getElementById("search-title"),m=document.getElementById("search-text"),r=e.get("q");if(null==r||""==r.trim())t.innerText=translated.page_title,p.remove(),m.innerText=translated.serp_text;else{let g=window.location.origin+"/";"pt"!=lang&&(g=g+lang+"/"),loadIndex(lang,r).then(s=>{if(t.innerText=translated.serp_title+": "+r,s){var e=s.results.length;if(e){m.remove();const c=document.getElementById("search-results"),d=document.createElement("div");p.innerHTML=1==e?e+" "+translated.search_title_single:e+" "+translated.search_title_plural,d.setAttribute("class","flex flex-wrap");let r=[];for(const h in s.results){let e=s.corpus[s.results[h].ref].publishdate,t=s.corpus[s.results[h].ref].summary;var l=g+"categories/"+s.corpus[s.results[h].ref].categories,i=g+"stories/"+s.corpus[s.results[h].ref].permalink;var o=i+"images/thumbnail.jpg";r.push({author:s.corpus[s.results[h].ref].author,publishdate:e,formatteddate:e.replace(/(\d+)\-(\d+)\-(\d+)T(\d+)\:(\d+)\:(\d+).*/,"$3/$2/$1 $4:$5:$6"),category:s.corpus[s.results[h].ref].categories,categorylink:l,title:s.corpus[s.results[h].ref].title,thumbnail_exists:s.corpus[s.results[h].ref].thumbnail_exists,thumbnail:o,summary:199<t.length?t.substring(0,200)+" ...":t,permalink:i,read_more:translated.read_more})}let n=1,a=paginate(r,6,n);if(render(d,"post_thumbnail",{matches_page:a},"create").then(e=>c.append(e)),6<r.length){var u=r.length/6;let t=[1];for(let e=1;e<u;e++)t.push(e+1);let e=render(c,"pagination",{current_page:n,pages:t},"update");e.then(e=>{let t=e.getElementsByClassName("button-page");t[0].setAttribute("class","button-page bg-gray-900 hover:no-underline hover:text-white focus:ring-gray-900 dark:text-white dark:hover:text-white"),t[0].parentElement.setAttribute("aria-current","page");for(let e=0;e<t.length;e++)t[e].addEventListener("click",function(e){n=parseInt(this.innerHTML),this.setAttribute("class","button-page bg-gray-900 hover:no-underline hover:text-white focus:ring-gray-900 dark:text-white dark:hover:text-white"),this.parentElement.setAttribute("aria-current","page");for(let e=0;e<t.length;e++)t[e].innerHTML!=this.innerHTML&&(t[e].setAttribute("class","button-page bg-primary hover:no-underline hover:text-white hover:bg-primary-darker focus:ring-primary-darker dark:text-white dark:hover:text-white"),t[e].parentElement.removeAttribute("aria-current"));a=paginate(r,6,n),render(d,"post_thumbnail",{matches_page:a},"create")})})}}else m.innerText=translated.serp_text_not_found}})}});
