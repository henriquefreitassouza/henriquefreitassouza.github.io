let T=t=>fetch("/i18n/search.json").then(e=>e.json()).then(e=>e[t]),loadIndex=(e,t)=>fetch("/search-index."+e+".json").then(e=>e.json()).then(e=>({results:lunr.Index.load(e.index).search(t),corpus:e.corpus})).catch(e=>null),render=(r,e,n,a="create")=>fetch("/js/templates/"+e+".html").then(e=>e.text()).then(e=>{let t=Handlebars.compile(e);return"update"==a?r.insertAdjacentHTML("beforeend",t(n)):r.innerHTML=t(n),r}),paginate=(e,t,r)=>e.slice((r-1)*t,t*r);const lang=document.documentElement.getAttribute("lang"),translate=T(lang);let translated={};translate.then(r=>{Object.keys(r).forEach(function(e,t){translated[e]=r[e]})}),window.addEventListener("load",()=>{const e=new URLSearchParams(window.location.search),t=document.getElementsByTagName("h1")[0],g=document.getElementById("search-title"),p=document.getElementById("search-text"),n=e.get("q");if(null==n||""==n.trim())t.innerText=translated.page_title,g.remove(),p.innerText=translated.serp_text;else{let d=window.location.origin+"/";"pt"!=lang&&(d=d+lang+"/"),loadIndex(lang,n).then(r=>{if(t.innerText=translated.serp_title+": "+n,r){var e=r.results.length;if(e){p.remove();const u=document.getElementById("search-results"),h=document.createElement("div");g.innerHTML=1==e?e+" "+translated.search_title_single:e+" "+translated.search_title_plural,h.setAttribute("class","flex flex-wrap");let n=[];for(const c in r.results){let e=r.corpus[r.results[c].ref].publishdate,t=r.corpus[r.results[c].ref].summary;var l=d+"categories/"+r.corpus[r.results[c].ref].categories,i=d+"stories/"+r.corpus[r.results[c].ref].permalink,o=i+"images/thumbnail.jpg";n.push({author:r.corpus[r.results[c].ref].author,publishdate:e,formatteddate:e.replace(/(\d+)\-(\d+)\-(\d+)T(\d+)\:(\d+)\:(\d+).*/,"$3/$2/$1 $4:$5:$6"),category:r.corpus[r.results[c].ref].categories,categorylink:l,title:r.corpus[r.results[c].ref].title,thumbnail_exists:r.corpus[r.results[c].ref].thumbnail_exists,thumbnail:o,summary:199<t.length?t.substring(0,200)+" ...":t,permalink:i,read_more:translated.read_more})}let a=1,s=paginate(n,6,a);render(h,"post_thumbnail",{matches_page:s},"create").then(e=>u.append(e)).then(e=>{if(6<n.length){var r=n.length/6;let t=[1];for(let e=1;e<r;e++)t.push(e+1);let e=render(u,"pagination",{current_page:a,pages:t},"update");e.then(e=>{let t=e.getElementsByClassName("button-page");t[0].setAttribute("class","button-page bg-gray-900 hover:no-underline hover:text-white focus:ring-gray-900 dark:text-white dark:hover:text-white"),t[0].parentElement.setAttribute("aria-current","page");for(let e=0;e<t.length;e++)t[e].addEventListener("click",function(e){a=parseInt(this.innerHTML),this.setAttribute("class","button-page bg-gray-900 hover:no-underline hover:text-white focus:ring-gray-900 dark:text-white dark:hover:text-white"),this.parentElement.setAttribute("aria-current","page");for(let e=0;e<t.length;e++)t[e].innerHTML!=this.innerHTML&&(t[e].setAttribute("class","button-page bg-primary hover:no-underline hover:text-white hover:bg-primary-darker focus:ring-primary-darker dark:text-white dark:hover:text-white"),t[e].parentElement.removeAttribute("aria-current"));s=paginate(n,6,a),render(h,"post_thumbnail",{matches_page:s},"create")})})}})}else p.innerText=translated.serp_text_not_found}})}});